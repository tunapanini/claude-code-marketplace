{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://claude-code-marketplace.github.io/schemas/plugin.schema.json",
  "title": "Claude Code Plugin",
  "description": "Schema for Claude Code plugin metadata",
  "type": "object",
  "required": ["name", "version", "description", "type", "author"],
  "properties": {
    "name": {
      "type": "string",
      "description": "Unique plugin identifier",
      "pattern": "^[a-z0-9-]+$"
    },
    "version": {
      "type": "string",
      "description": "Semantic version",
      "pattern": "^\\d+\\.\\d+\\.\\d+$"
    },
    "description": {
      "type": "string",
      "description": "Brief description of the plugin"
    },
    "type": {
      "type": "string",
      "enum": ["mcp-server", "command", "hook", "agent"],
      "description": "Type of plugin"
    },
    "author": {
      "type": "object",
      "required": ["name"],
      "properties": {
        "name": { "type": "string" },
        "github": { "type": "string" },
        "url": { "type": "string", "format": "uri" }
      }
    },
    "repository": {
      "type": "string",
      "format": "uri",
      "description": "GitHub repository URL"
    },
    "license": {
      "type": "string",
      "description": "SPDX license identifier"
    },
    "tags": {
      "type": "array",
      "items": { "type": "string" },
      "description": "Searchable tags"
    },
    "install": {
      "type": "object",
      "description": "Installation instructions",
      "properties": {
        "npm": {
          "type": "string",
          "description": "npm package name"
        },
        "command": {
          "type": "string",
          "description": "Shell command to install"
        },
        "config": {
          "type": "object",
          "description": "Configuration to add to claude_desktop_config.json or settings.json"
        }
      }
    },
    "requirements": {
      "type": "object",
      "properties": {
        "node": { "type": "string" },
        "claude-code": { "type": "string" },
        "os": {
          "type": "array",
          "items": { "type": "string", "enum": ["darwin", "linux", "win32"] }
        }
      }
    }
  },
  "allOf": [
    {
      "if": { "properties": { "type": { "const": "mcp-server" } } },
      "then": {
        "properties": {
          "mcp": {
            "type": "object",
            "required": ["tools"],
            "properties": {
              "tools": {
                "type": "array",
                "items": { "type": "string" },
                "description": "List of tools provided by this MCP server"
              },
              "resources": {
                "type": "array",
                "items": { "type": "string" }
              },
              "prompts": {
                "type": "array",
                "items": { "type": "string" }
              }
            }
          }
        }
      }
    },
    {
      "if": { "properties": { "type": { "const": "command" } } },
      "then": {
        "properties": {
          "command": {
            "type": "object",
            "required": ["name"],
            "properties": {
              "name": {
                "type": "string",
                "description": "Slash command name (without /)"
              },
              "arguments": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "name": { "type": "string" },
                    "required": { "type": "boolean" },
                    "description": { "type": "string" }
                  }
                }
              }
            }
          }
        }
      }
    },
    {
      "if": { "properties": { "type": { "const": "hook" } } },
      "then": {
        "properties": {
          "hook": {
            "type": "object",
            "required": ["event"],
            "properties": {
              "event": {
                "type": "string",
                "enum": [
                  "PreToolUse",
                  "PostToolUse",
                  "Notification",
                  "Stop",
                  "SubagentStop"
                ],
                "description": "Hook event type"
              },
              "matcher": {
                "type": "string",
                "description": "Tool name pattern to match"
              }
            }
          }
        }
      }
    },
    {
      "if": { "properties": { "type": { "const": "agent" } } },
      "then": {
        "properties": {
          "agent": {
            "type": "object",
            "required": ["category"],
            "properties": {
              "category": {
                "type": "string",
                "enum": ["engineering", "quality", "analysis", "devops", "documentation"],
                "description": "Agent category"
              },
              "tools": {
                "type": "array",
                "items": { "type": "string" },
                "description": "Tools this agent uses"
              },
              "triggers": {
                "type": "array",
                "items": { "type": "string" },
                "description": "Scenarios that activate this agent"
              }
            }
          }
        }
      }
    }
  ]
}
